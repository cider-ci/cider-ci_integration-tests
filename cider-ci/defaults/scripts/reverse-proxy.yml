run-reverse-proxy:
  timeout: 300
  body: |
    #!/usr/bin/env bash
    set -eux
    cd integration-tests
    LD_LIBRARY_PATH=/usr/lib/apache2/modules/ /usr/sbin/apache2 -d reverse-proxy/ -f conf/httpd.conf -e info -DFOREGROUND
  terminate-when:
    - script: reverse-proxy-shutdown
      states: [aborted, passed, failed, skipped]


shutdown-reverse-proxy:
  timeout: 5
  body: |
    set -eux
    kill -INT $(lsof -t -wni tcp:${REVERSE_PROXY_HTTP_PORT})
    sleep 1
  start-when:
    - script: test
      states: [aborted, passed, failed, skipped]
