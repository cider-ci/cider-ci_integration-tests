documentation:

  script-defaults:
    template-environment-variables: true
    environment-variables:
      DISPLAY: ":{{XVNC_PORT}}"
    timeout: 300

  task-defaults:

    _cider-ci_include:
      - cider-ci/defaults/attachments.yml
      - cider-ci/defaults/misc.yml
      - cider-ci/defaults/ports.yml
      - cider-ci/subcontexts/documentation/scripts.yml
      - cider-ci/subcontexts/documentation/traits.yml

  tasks:
    check_compiled_documentation:
      scripts:
        test:
          body: |
            set -eux
            cd documentation-source
            bundle
            bundle exec rspec spec/test_spec.rb
          start-when:
            - script: start-xvnc
              states: [passed]
            - script: run-reverse-proxy
              states: [executing]


# tasks:
#   spec/features/admin/repositories_spec.rb:
#     environment-variables:
#       CIDER_CI_TASK_FILE: spec/features/builder/contexts_spec.rb
