documentation:

  script-defaults:
    template-environment-variables: true
    environment-variables:
      DISPLAY: ":{{XVNC_PORT}}"
    timeout: 300

  task-defaults:
    environment-variables:
        RBENV_VERSION: 2.2.4
    _cider-ci_include:
      - cider-ci/defaults/attachments.yml
      - cider-ci/defaults/misc.yml
      - cider-ci/defaults/ports.yml
      - cider-ci/subcontexts/documentation/scripts.yml
      - cider-ci/subcontexts/documentation/traits.yml

  tasks:
    check_compiled_documentation:
      scripts:
        bundle:
          exclusive-executor-resource: rbenv
          timeout: 20 Minutes
          body: |
            set -eux
            cd documentation-source
            ${CIDER_CI_WORKING_DIR}/integration-tests/cider-ci/bin/bundle
        test:
          body: |
            set -eux
            cd documentation-source
            bundle exec rspec spec/test_spec.rb
          start-when:
            - script: bundle
              states: [passed]
            - script: start-xvnc
              states: [passed]
            - script: run-reverse-proxy
              states: [executing]


# tasks:
#   spec/features/admin/repositories_spec.rb:
#     environment-variables:
#       CIDER_CI_TASK_FILE: spec/features/builder/contexts_spec.rb
